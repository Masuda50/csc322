{% extends 'layout.html' %} #makes sure the nav
{% block title %}WhiteBoard Home{% endblock %}
{% block nav %}
<a href="{{ url_for('post') }}"><i class="fas fa-post"></i>Post</a>
{% endblock %}

{% block content %}

<div class="content">
    <h2 class="text-center group-page__heading"> Group Page of {{group.group_name}}</h2>
</div>

<div class="main">
    <p class="info"><b>Group Members:</b> {{ members }}</p>
    <p class="info"><b>Description:</b> {{ description}}</p>
</div>

{#    If User is a group member in the group, show create post form and create poll form #}
{# Create Post Form #}
{#  Create Poll Form  #}
    <div class="poll-parent-container container">
    <button type="button" class="btn btn-info" onClick="togglePollForm()">Create Poll</button>

        <div class="row poll-form-container d-flex col-md-6 mx-auto" id="pollFormContainer">
            <div class="poll-form-content col-md-12">
            <form id="createPollForm" class="col-md-8" action="{{ url_for('create_poll', group_name=group.group_name) }}" method="post">
                <div class="form-input-content" id="formInputContent">
                      <div class="form-group">
                        <input type="text" class="form-control" id="poll-title" name="poll-title" placeholder="Poll Title">
                      </div>
                      <div class="form-group">
                        <input type="text" class="form-control" id="poll-question" name="poll-question" placeholder="Your Question">
                      </div>
                        <div class="form-group">
                            <input type="text" class="form-control" name="poll-option" placeholder="Option">
                        </div>
                </div>
                <div class="btnContainer">
                    <div class="text-align">
                        <button type="button"class="btn btn-link" onClick="addOptionField()" id="addMoreBtn">Add More Option</button>
                        <button type="submit" class="btn btn-primary">Create</button>
                    </div>
                </div>
            </form>
            </div>
        </div>
</div>

{#  if group posts exists  #}
{% for ps in post %}
   <ul>
        <li>
            <div class="post-group">
                <p class="post-title"><a href="{{ url_for('into_reply', post_id=ps.post_id) }}">
                    {{ ps.post_title }}</a></p>
                <P class="post-content">{{ ps.post_content }}</P>
                <div class="post-info">
                    <span class="post-author"><a href="{{ url_for('poster_profile', poster_id=ps.user_id) }}">
                        {{ ps.user_name }}</a></span>
                    <span class="post-time">{{ ps.post_time }}</span>
                </div>
            </div>
        </li>
   </ul>
{% endfor %}
{% if polls %}
    <h2 class="text-center">Current Polls</h2>
    {% for poll in polls %}
        <div class="container col-md-4 mx-auto">
                <div class="card">
                  <div class="card-header">
                    <h5 class="card-title">{{ poll.poll_title }}</h5>
                  </div>
                    <div class="row">
                      <div class="card-body">
                        <p class="card-text">{{ poll.poll_body }}</p>
                      </div>
                      <div class="card-body">
                          <button type="button" class="btn btn-primary submitPoll-btn" onClick="">Respond</button>
                      </div>
                    </div>


                            <div class="pollOptions-container row">
                                <div class="pollOptions-content container text-center">
                                        <div class="row">
                                        {% for option in poll['group_concat(optionText)'] %}
                                            <div class="pollOptions-option col-lg-4">
                                                <input type="radio" name="{{ option }}" value="{{ option }}">
                                                <label for="{{ option }}">{{ option }}</label>
                                            </div>
                                        {% endfor %}
                                        </div>

                                    <div class="pollOptions-btn text-center">
                                        <button type="submit" class="btn btn-warning">Vote</button>
                                    </div>
                                    </div>
                            </div>




                </div>

        </div>
    {% endfor %}
{% endif %}
<script>
    var pollOption = document.getElementsByClassName('pollOptions-container')

    /** get respond button index **/
    var submitPollBtn = document.getElementsByClassName('submitPoll-btn')

    for(var i = 0; i < pollOption.length; i++){
        pollOption[i].style.display = 'none';
    }

    for (var i = 0; i < submitPollBtn.length; i++) {
            (function (i) {
                submitPollBtn[i].addEventListener('click', function (event) {
                    console.log(i);
                    console.log(pollOption[i]);

                    if (pollOption[i].style.display === ''){
                        pollOption[i].style.display = 'none';
                    }
                    if (pollOption[i].style.display === "none") {
                        pollOption[i].style.display = "block";
                    } else {
                        pollOption[i].style.display = "none";
                    }

                }, false);
            })(i);
        }


    function togglePollForm() {

        var x = document.getElementById("createPollForm");
        if (x.style.display === ''){
            x.style.display = 'none';
        }
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }

    }

        function addOptionField() {
            var newOption = '<div class="form-group"><input type="text" class="form-control" name="poll-option" placeholder="Option"></div>';
            $('#formInputContent').append(newOption);
        }



</script>
{% endblock %}


